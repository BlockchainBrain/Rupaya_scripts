WALLETS=6

# first arg: number or all
# second arg: function to run which should a number or nothing as its first argument
exec_function_for_all_or_one(){
	if [ "$1" == "all" ]; then
		$2
		for i in $(seq 2 $WALLETS); do
			$2 $i
		done
	elif [[ "$1" =~ ^[0-9]*$ ]]; then # check if $1 is an integer or nothing
		$2 $1
	else
		echo 'Expected a number or "all" after command name to indicate wallet(s)'
	fi
}

run_as_rupxmn(){
	echo "rupxmn$1 " && sudo runuser -l "rupxmn$1" -c "$2"
}

rpcli(){
	cli_func(){
		run_as_rupxmn $1 "rupaya-cli $2"
	}
	exec_function_for_all_or_one $1 cli_func
}

rinfo(){
	echo Checking the Rupaya wallet version, block count, and connections
	rpcli $1 getinfo
}

start(){
	start_func(){
		run_as_rupxmn $1 "rupayad -daemon"
	}
	exec_function_for_all_or_one $1 start_func
}

stop() {
	rpcli $1 stop
}

resync(){
	resync_func(){
		run_as_rupxmn "rupayad -daemon -resync"
	}
	exec_function_for_all_or_one $1 resync_func
}

rps(){
	echo Checking to see if the Rupaya Daemon is running
	ps -ef | grep rupaya
}

bc(){
	echo Checking the Block Count
	rpcli $1 getblockcount
}

mnstatus(){
	rpcli $1 "masternode status"
}

COMMANDS="bc rinfo rps start stop resync mnstatus"

for c in $COMMANDS; do
	if [ "$1" == "$c" ]; then
		$@
		break
	fi
done
